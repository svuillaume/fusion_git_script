
global
  master-worker
  stats socket /var/run/hapee-lb.sock level admin mode 660
  stats timeout 30000
  log-send-hostname

defaults unnamed_defaults_1
  mode http
  log global
  option httplog clf
  timeout http-request 5000
  timeout connect 5000
  timeout client 30000
  timeout server 10000

frontend fe_texas
  mode http
  bind *:443 name tls_offload crt /var/lib/dataplaneapi/storage/certs/sam_demo_haproxy_com.pem ssl
  option http-keep-alive
  default_backend be

backend be
  mode http
  balance roundrobin
  option httpchk
  http-check connect port 5679
  http-check send meth HEAD uri /
  server app1 172.16.22.201:5679 check enabled
  server app2 172.16.22.202:5679 check enabled

backend rate_limiting
  stick-table type ip size 1073741824 expire 120000 peers "${peers_section_name}" store http_req_rate(10s)

backend rate_limiting.agg
  stick-table type ip size 1073741824 expire 120000 peers "${peers_section_name}" store http_req_rate(10s)
